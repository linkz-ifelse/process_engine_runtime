const fs = require('fs');
const path = require('path');

const env = process.env.NODE_ENV || 'sqlite';

const userDataFolderPath = require('platform-folders').getConfigHome();
const userDataProcessEngineFolderName = 'process_engine_runtime';
const processEngineDatabaseFolderName = 'databases';

const databaseBasePath = path.join(userDataFolderPath, userDataProcessEngineFolderName, processEngineDatabaseFolderName);

// TODO: We REALLY should put ALL tables into the same database!
// Otherwise the migrations will NOT work as expected, if multiple tables were updated!
const flowNodeRepositoryStoragePath = path.join(databaseBasePath, 'flow_node_instances.sqlite');

const sqliteconfig = `{
  "info": "This file is auto generated and required by the sequelize-cli. Please do not remove.",
  "username": null,
  "password": null,
  "database": null,
  "host": null,
  "port": null,
  "dialect": "sqlite",
  "storage": "${flowNodeRepositoryStoragePath}",
  "supportBigNumbers": true,
  "resetPasswordRequestTimeToLive": 12,
  "logging": false
}`;

fs.writeFileSync('./sequelize/sqlite.json', sqliteconfig, 'utf-8');

module.exports = {
  'config': path.resolve('sequelize', `${env}.json`),
  'migrations-path': path.resolve('sequelize', 'migrations')
}
